<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Numbers Accessibility Palette Generator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind
        tailwind.config = {
            theme: {
                extend: {}
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Utility functions
        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (!result) throw new Error('Invalid hex color');
            
            return {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            };
        };

        const rgbToHex = ({ r, g, b }) => {
            const toHex = (n) => {
                const hex = n.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        };

        const rgbToHsl = ({ r, g, b }) => {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h = 0, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }

                h /= 6;
            }

            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        };

        const hslToRgb = ({ h, s, l }) => {
            s /= 100;
            l /= 100;
            const k = (n) => (n + h / 30) % 12;
            const a = s * Math.min(l, 1 - l);
            const f = (n) =>
                l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));

            return {
                r: Math.round(255 * f(0)),
                g: Math.round(255 * f(8)),
                b: Math.round(255 * f(4))
            };
        };

        const getLuminance = ({ r, g, b }) => {
            const [rs, gs, bs] = [r, g, b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        };

        const GRADE_LUMINANCE = {
            0: { min: 1.000, max: 1.000 },
            5: { min: 0.850, max: 0.930 },
            10: { min: 0.750, max: 0.820 },
            20: { min: 0.500, max: 0.650 },
            30: { min: 0.350, max: 0.450 },
            40: { min: 0.225, max: 0.300 },
            50: { min: 0.175, max: 0.183 },
            60: { min: 0.100, max: 0.125 },
            70: { min: 0.050, max: 0.070 },
            80: { min: 0.020, max: 0.040 },
            90: { min: 0.005, max: 0.015 },
            100: { min: 0.000, max: 0.000 }
        };

        const getGradeFromLuminance = (luminance) => {
            for (const [grade, range] of Object.entries(GRADE_LUMINANCE)) {
                if (luminance >= range.min && luminance <= range.max) {
                    return parseInt(grade);
                }
            }
            return -1;
        };

        const adjustSaturation = (grade, saturation) => {
            if (grade <= 5) {
                return Math.max(0, saturation * 0.5);
            } else if (grade <= 20) {
                return Math.max(0, saturation * 0.7);
            } else if (grade >= 80) {
                return Math.max(0, saturation * 0.6);
            } else if (grade >= 60) {
                return Math.max(0, saturation * 0.8);
            }
            return Math.max(0, saturation * 0.9);
        };

        const adjustColorForGrade = (grade, hsl) => {
            if (grade === 100) {
                return { h: hsl.h, s: 0, l: 0 };
            }
            
            const targetLuminance = (GRADE_LUMINANCE[grade].min + GRADE_LUMINANCE[grade].max) / 2;
            let adjustedHsl = { ...hsl };
            
            adjustedHsl.s = adjustSaturation(grade, hsl.s);
            
            let min = 0;
            let max = 100;
            let l = hsl.l;
            let iterations = 0;
            const maxIterations = 20;
            
            while (iterations < maxIterations) {
                const rgb = hslToRgb({ ...adjustedHsl, l });
                const currentLuminance = getLuminance(rgb);
                
                if (Math.abs(currentLuminance - targetLuminance) < 0.001) {
                    break;
                }
                
                if (currentLuminance > targetLuminance) {
                    max = l;
                    l = (min + l) / 2;
                } else {
                    min = l;
                    l = (l + max) / 2;
                }
                
                iterations++;
            }
            
            adjustedHsl.l = l;
            
            if (grade <= 20) {
                adjustedHsl.h = (adjustedHsl.h + 2) % 360;
            } else if (grade >= 80) {
                adjustedHsl.h = (adjustedHsl.h - 2 + 360) % 360;
            }
            
            return adjustedHsl;
        };

        const generatePalette = (baseHex) => {
            const baseRgb = hexToRgb(baseHex);
            const baseHsl = rgbToHsl(baseRgb);
            const baseLuminance = getLuminance(baseRgb);
            const baseGrade = getGradeFromLuminance(baseLuminance);

            const grades = [0, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
            
            return grades.map(grade => {
                if (grade === baseGrade) {
                    return {
                        grade,
                        hex: baseHex.toLowerCase(),
                        rgb: baseRgb,
                        hsl: baseHsl,
                        luminance: baseLuminance
                    };
                }

                const hsl = adjustColorForGrade(grade, baseHsl);
                const rgb = hslToRgb(hsl);
                const hex = rgbToHex(rgb);
                const luminance = getLuminance(rgb);
                
                return {
                    grade,
                    hex,
                    rgb,
                    hsl,
                    luminance
                };
            });
        };

        // Icons as components
        const CopyIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
            </svg>
        );

        const CheckIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"/>
            </svg>
        );

        const ChevronDownIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m6 9 6 6 6-6"/>
            </svg>
        );

        const ChevronUpIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m18 15-6-6-6 6"/>
            </svg>
        );

        const HelpCircleIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>
            </svg>
        );

        const AlertTriangleIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>
            </svg>
        );

        function App() {
            const [hexColor, setHexColor] = React.useState('#ffffff');
            const [palette, setPalette] = React.useState(() => generatePalette('#ffffff'));
            const [copiedColor, setCopiedColor] = React.useState(null);
            const [gradeInfo, setGradeInfo] = React.useState(null);
            const [isGuideOpen, setIsGuideOpen] = React.useState(false);
            
            const handleColorChange = React.useCallback((e) => {
                let value = e.target.value.replace('##', '#');
                if (!value.startsWith('#')) {
                    value = '#' + value;
                }
                setHexColor(value);
                
                try {
                    if (value.length >= 7) {
                        const rgb = hexToRgb(value);
                        const luminance = getLuminance(rgb);
                        const grade = getGradeFromLuminance(luminance);
                        
                        if (grade === -1) {
                            const newPalette = generatePalette(value);
                            setPalette(newPalette);
                            
                            const closestGrades = findClosestGrades(luminance);
                            setGradeInfo(`This color falls between grades ${closestGrades.lower} and ${closestGrades.upper}`);
                        } else {
                            setPalette(generatePalette(value));
                            setGradeInfo(null);
                        }
                    } else if (value.length === 7) {
                        const rgb = hexToRgb(value);
                        setPalette(generatePalette(value));
                        setGradeInfo(null);
                    } else {
                        setGradeInfo(null);
                    }
                } catch (error) {
                    if (value.length >= 7) {
                        console.error('Invalid color code');
                        setGradeInfo('Please enter a valid hex color code');
                    } else {
                        setGradeInfo(null);
                    }
                }
            }, []);

            const findClosestGrades = (luminance) => {
                const grades = [0, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
                const luminanceValues = [
                    1.000, 0.890, 0.785, 0.575, 0.400, 0.263, 0.179, 0.113, 0.060, 0.030, 0.010, 0.000
                ];
                
                let lowerIndex = 0;
                for (let i = 0; i < luminanceValues.length; i++) {
                    if (luminanceValues[i] <= luminance) {
                        lowerIndex = i;
                        break;
                    }
                }
                
                if (lowerIndex === 0 && luminance > luminanceValues[0]) {
                    return { lower: 0, upper: 0 };
                }
                
                if (lowerIndex === luminanceValues.length - 1) {
                    return { lower: grades[luminanceValues.length - 1], upper: grades[luminanceValues.length - 1] };
                }
                
                const upperIndex = lowerIndex === 0 ? 1 : lowerIndex - 1;
                
                return {
                    lower: grades[lowerIndex],
                    upper: grades[upperIndex]
                };
            };

            const copyToClipboard = (hex) => {
                navigator.clipboard.writeText(hex);
                setCopiedColor(hex);
                setTimeout(() => setCopiedColor(null), 2000);
            };

            const toggleGuide = () => {
                setIsGuideOpen(!isGuideOpen);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100/50">
                    <header className="bg-white border-b border-gray-200">
                        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-16">
                                <h1 className="text-2xl font-bold">Magic Numbers</h1>
                                <div className="text-sm text-gray-600">
                                    Created by{' '}
                                    <a href="https://www.linkedin.com/in/sviatoslav-nytka/" target="_blank" rel="noopener noreferrer" className="text-black hover:text-gray-700 underline">
                                        Sviatoslav Nytka
                                    </a>
                                    {' '}from{' '}
                                    <a href="https://magicflux.co" target="_blank" rel="noopener noreferrer" className="text-black hover:text-gray-700 underline">
                                        MagicFlux
                                    </a>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="py-12 px-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white border border-gray-200 p-6 mb-10">
                                <div className="max-w-xl">
                                    <div className="flex flex-col sm:flex-row sm:items-start gap-4">
                                        <div className="flex-1">
                                            <label htmlFor="color" className="block text-lg font-medium text-gray-900 mb-3">
                                                HEX Color Code
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type="text"
                                                    id="color"
                                                    value={hexColor}
                                                    onChange={handleColorChange}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 text-lg font-mono transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
                                                    placeholder="#000000"
                                                />
                                                {gradeInfo && (
                                                    <div className="mt-2 text-sm text-black flex items-center gap-2">
                                                        <AlertTriangleIcon />
                                                        {gradeInfo}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        <div className="sm:pt-11">
                                            <button
                                                onClick={toggleGuide}
                                                aria-expanded={isGuideOpen}
                                                className="w-full sm:w-auto px-4 py-3 flex items-center justify-between sm:justify-start gap-2 text-left bg-gray-50 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2"
                                            >
                                                <div className="flex items-center gap-2">
                                                    <HelpCircleIcon />
                                                    <span className="text-sm font-medium text-gray-900">Magic Numbers Guide</span>
                                                </div>
                                                {isGuideOpen ? <ChevronUpIcon /> : <ChevronDownIcon />}
                                            </button>
                                        </div>
                                    </div>

                                    {isGuideOpen && (
                                        <div className="mt-4 space-y-4">
                                            <div className="space-y-2 text-sm text-gray-700">
                                                <p>
                                                    This tool is inspired by{' '}
                                                    <a 
                                                        href="https://designsystem.digital.gov/design-tokens/color/overview/"
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="text-black hover:text-gray-700 font-medium underline"
                                                    >
                                                        USWDS
                                                    </a>
                                                    , to help you create color combinations that meet accessibility standards.
                                                </p>
                                                <p>System assigns each color a grade from 0 (white) to 100 (black).</p>
                                                <p>The "magic number" is simply the difference between the grades of two colors.</p>
                                                <div className="space-y-1">
                                                    <p className="font-medium text-gray-900">Accessibility levels:</p>
                                                    <ul className="list-disc list-inside space-y-1 ml-2">
                                                        <li>40+: Meets WCAG 2.2 AA for large text (3+)</li>
                                                        <li>50+: Meets WCAG 2.2 AA for standard text and AAA for large text (4.5+)</li>
                                                        <li>70+: Meets WCAG 2.2 AAA for standard text (7+)</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                {palette.map((color) => (
                                    <div
                                        key={color.grade}
                                        className={`bg-white/80 backdrop-blur-sm overflow-hidden hover:shadow-lg transition-all duration-200 ${
                                            color.hex.toLowerCase() === hexColor.toLowerCase()
                                                ? 'ring-2 ring-black'
                                                : 'border border-gray-200'
                                        }`}
                                    >
                                        <button
                                            onClick={() => copyToClipboard(color.hex)}
                                            className="w-full group focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2"
                                        >
                                            <div
                                                className="h-28 relative flex items-center justify-center transition-all duration-200"
                                                style={{ backgroundColor: color.hex }}
                                            >
                                                {copiedColor === color.hex ? (
                                                    <div className="flex items-center gap-1.5 px-4 py-2 bg-white text-gray-900 shadow-lg">
                                                        <CheckIcon />
                                                        <span className="text-sm font-medium">Copied!</span>
                                                    </div>
                                                ) : (
                                                    <div className="flex items-center gap-1.5 px-4 py-2 bg-white text-gray-900 opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-all duration-200 shadow-lg">
                                                        <CopyIcon />
                                                        <span className="text-sm font-medium">Copy</span>
                                                    </div>
                                                )}
                                            </div>
                                            <div className="p-4">
                                                <div className="flex items-center justify-between mb-1.5">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-sm font-semibold text-gray-900">Grade {color.grade}</span>
                                                        {color.hex.toLowerCase() === hexColor.toLowerCase() && (
                                                            <div className="w-2 h-2 bg-black" />
                                                        )}
                                                    </div>
                                                    <span className="text-xs font-mono text-gray-500">{color.hex.toUpperCase()}</span>
                                                </div>
                                                <div className="flex items-center justify-between">
                                                    <p className="text-xs text-gray-500">
                                                        Luminance: {color.luminance.toFixed(3)}
                                                    </p>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</body>
</html>
